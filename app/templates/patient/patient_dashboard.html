{% extends "base.html" %}

{% block title %}My Dashboard{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1 class="h3 fw-bold mb-1">Welcome, {{ patient.user.first_name }}</h1>
        <p class="text-muted">Manage your health and appointments from one place.</p>
    </div>
</div>

<!-- Stats Row -->
<div class="row g-4 mb-4">
    <div class="col-md-4">
        <div class="card p-3 border-0 shadow-sm border-top border-4 border-primary">
            <div class="stat-card-icon bg-soft-primary mb-2">
                <i class="bi bi-calendar2-heart"></i>
            </div>
            <h6 class="uppercase-label mb-1">Total Consultations</h6>
            <h3 class="fw-bold mb-0 text-dark">{{ stats.total_appointments }}</h3>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card p-3 border-0 shadow-sm border-top border-4 border-warning">
            <div class="stat-card-icon bg-soft-warning mb-2">
                <i class="bi bi-hourglass-split"></i>
            </div>
            <h6 class="uppercase-label mb-1">Upcoming Appointments</h6>
            <h3 class="fw-bold mb-0 text-dark">{{ stats.upcoming_appointments }}</h3>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card p-3 border-0 shadow-sm border-top border-4 border-success">
            <div class="stat-card-icon bg-soft-success mb-2">
                <i class="bi bi-file-earmark-medical"></i>
            </div>
            <h6 class="uppercase-label mb-1">Prescriptions Issued</h6>
            <h3 class="fw-bold mb-0 text-dark">{{ stats.completed_appointments }}</h3>
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- Upcoming Appointments -->
    <div class="col-lg-8">
        <div class="table-container border-0 shadow-sm">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="fw-bold mb-0 text-dark">Schedule Overview</h5>
                <a href="{{ url_for('patient.my_appointments') }}" class="btn btn-sm btn-light border">Full History</a>
            </div>
            {% if appointments %}
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead>
                            <tr>
                                <th>Specialist</th>
                                <th>Appointment Slot</th>
                                <th>Status</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for appt in appts %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="avatar-sm bg-soft-teal rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                            <i class="bi bi-person-heart text-primary"></i>
                                        </div>
                                        <div>
                                            <div class="fw-bold text-dark small">Dr. {{ appt.doctor.user.last_name }}</div>
                                            <div class="text-muted x-small font-italic">{{ appt.doctor.specialization }}</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="fw-bold text-dark small">{{ appt.appointment_date.strftime('%d %b, %Y') }}</div>
                                    <div class="text-muted x-small"><i class="bi bi-clock me-1"></i> {{ appt.appointment_time.strftime('%I:%M %p') }}</div>
                                </td>
                                <td>
                                    <span class="badge {% if appt.status == 'approved' %}bg-soft-success text-success{% else %}bg-soft-warning text-warning{% endif %}">
                                        {{ appt.status | capitalize }}
                                    </span>
                                </td>
                                <td class="text-end">
                                    <form action="{{ url_for('patient.cancel_appointment', appointment_id=appt.id) }}" method="POST" onsubmit="return confirm('Cancel this appointment?')">
                                        <button type="submit" class="btn btn-sm btn-outline-danger border-0">
                                            <i class="bi bi-calendar-x me-1"></i> Cancel
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center py-5 bg-light rounded-4 border-dashed">
                    <div class="stat-card-icon bg-white mx-auto shadow-sm mb-3">
                        <i class="bi bi-calendar-check text-muted"></i>
                    </div>
                    <p class="text-muted mb-4 small">No upcoming medical appointments scheduled.</p>
                    <a href="{{ url_for('patient.list_doctors') }}" class="btn btn-primary shadow-sm px-4">
                        <i class="bi bi-search me-2"></i> Find a Specialist
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Quick Access Menu -->
    <div class="col-lg-4">
        <div class="card p-4 h-100 border-0 shadow-sm">
            <h5 class="fw-bold mb-4 text-dark">Patient Resources</h5>
            <div class="d-grid gap-3">
                <a href="{{ url_for('patient.list_doctors') }}" class="action-card bg-soft-primary p-3 rounded-4 d-flex align-items-center gap-3 text-decoration-none">
                    <div class="icon-circle bg-white text-primary">
                        <i class="bi bi-person-heart h5 mb-0 shadow-sm"></i>
                    </div>
                    <div>
                        <div class="fw-bold text-dark small">Find Specialists</div>
                        <div class="x-small text-muted">Map your care to our experts</div>
                    </div>
                </a>
                <a href="{{ url_for('patient.my_prescriptions') }}" class="action-card bg-soft-success p-3 rounded-4 d-flex align-items-center gap-3 text-decoration-none">
                    <div class="icon-circle bg-white text-success">
                        <i class="bi bi-journal-medical h5 mb-0 shadow-sm"></i>
                    </div>
                    <div>
                        <div class="fw-bold text-dark small">My Medical Records</div>
                        <div class="x-small text-muted">Digital prescriptions & history</div>
                    </div>
                </a>
                <div class="mt-2 p-3 rounded-4 bg-soft-info border-start border-4 border-info">
                    <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-info-circle-fill text-info me-2"></i>
                        <span class="fw-bold text-dark small">Need Immediate Care?</span>
                    </div>
                    <div class="text-muted x-small line-height-sm">
                        For medical emergencies, please dial <strong>108</strong> or visit our nearest 24/7 emergency care unit immediately.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .border-dashed { border: 2px dashed #e2e8f0; }
    .line-height-sm { line-height: 1.4; }
    .bg-soft-teal { background-color: #f0fdfa; }
</style>
{% endblock %}
{% endblock %}
