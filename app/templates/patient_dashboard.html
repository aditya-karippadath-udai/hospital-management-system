{% extends "base_patient.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <h2 class="fw-bold">Welcome, {{ patient.user.first_name }}! ðŸ‘‹</h2>
        <p class="text-muted">Manage your appointments and health records here.</p>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mb-4 g-3">
    <div class="col-6 col-md-3">
        <a href="{{ url_for('patient.list_doctors') }}" class="card stat-card text-decoration-none h-100 p-3 text-center border-primary bg-light">
            <div class="text-primary mb-2">
                <i class="fas fa-calendar-plus fa-2x"></i>
            </div>
            <h6 class="fw-bold text-dark m-0">Book Appointment</h6>
        </a>
    </div>
    <div class="col-6 col-md-3">
        <a href="{{ url_for('patient.list_doctors') }}" class="card stat-card text-decoration-none h-100 p-3 text-center">
            <div class="text-info mb-2">
                <i class="fas fa-user-md fa-2x"></i>
            </div>
            <h6 class="fw-bold text-dark m-0">View All Doctors</h6>
        </a>
    </div>
    <div class="col-6 col-md-3">
        <a href="{{ url_for('patient.my_appointments') }}" class="card stat-card text-decoration-none h-100 p-3 text-center">
            <div class="text-success mb-2">
                <i class="fas fa-clock fa-2x"></i>
            </div>
            <h6 class="fw-bold text-dark m-0">My Appointments</h6>
        </a>
    </div>
    <div class="col-6 col-md-3">
        <a href="{{ url_for('patient.my_prescriptions') }}" class="card stat-card text-decoration-none h-100 p-3 text-center">
            <div class="text-warning mb-2">
                <i class="fas fa-file-prescription fa-2x"></i>
            </div>
            <h6 class="fw-bold text-dark m-0">My Prescriptions</h6>
        </a>
    </div>
</div>

<div class="row">
    <!-- Stats Column -->
    <div class="col-lg-4">
        <div class="card p-4 mb-4 bg-primary text-white">
            <h5 class="fw-bold mb-3">Your Stats</h5>
            <div class="d-flex justify-content-between mb-2">
                <span>Total Appointments</span>
                <span class="badge bg-white text-primary rounded-pill">{{ stats.total_appointments }}</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
                <span>Completed</span>
                <span class="badge bg-white text-primary rounded-pill">{{ stats.completed_appointments }}</span>
            </div>
            <div class="d-flex justify-content-between">
                <span>Upcoming</span>
                <span class="badge bg-white text-primary rounded-pill">{{ stats.upcoming_appointments }}</span>
            </div>
        </div>
        
        <div class="card p-4">
            <h5 class="fw-bold mb-3">Profile Info</h5>
            <p class="mb-1"><i class="fas fa-phone-alt me-2 text-muted"></i> {{ patient.phone }}</p>
            <p class="mb-1"><i class="fas fa-id-card me-2 text-muted"></i> {{ patient.blood_group }}</p>
            <p class="mb-0"><i class="fas fa-envelope me-2 text-muted"></i> {{ patient.user.email }}</p>
            <hr>
            <a href="#" class="btn btn-sm btn-outline-primary d-block">Edit Profile</a>
        </div>
    </div>

    <!-- Upcoming Appointments Column -->
    <div class="col-lg-8">
        <div class="card h-100">
            <div class="card-header bg-white py-3">
                <h5 class="fw-bold mb-0">Upcoming Appointments</h5>
            </div>
            <div class="card-body">
                {% if appointments %}
                    <div class="table-responsive">
                        <table class="table align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>Doctor</th>
                                    <th>Date</th>
                                    <th>Time</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for appt in appointments %}
                                <tr>
                                    <td>
                                        <div class="fw-bold">Dr. {{ appt.doctor.user.full_name }}</div>
                                        <small class="text-muted">{{ appt.doctor.specialization }}</small>
                                    </td>
                                    <td>{{ appt.appointment_date.strftime('%d %b, %Y') }}</td>
                                    <td>{{ appt.appointment_time.strftime('%I:%M %p') }}</td>
                                    <td>
                                        <span class="badge rounded-pill bg-{{ 'warning' if appt.status == 'pending' else 'success' }}">
                                            {{ appt.status|capitalize }}
                                        </span>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-info">Detail</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <img src="https://cdni.iconscout.com/illustration/premium/thumb/no-appointment-booked-8610565-6831154.png" height="150" alt="No appt">
                        <p class="text-muted mt-3">You don't have any upcoming appointments.</p>
                        <a href="{{ url_for('patient.list_doctors') }}" class="btn btn-primary">Find a Doctor</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
